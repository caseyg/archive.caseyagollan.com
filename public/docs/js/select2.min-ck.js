/*
Copyright 2012 Igor Vaynberg
 
Version: 2.0 Timestamp: Wed, May 16, 2012 10:38:37 AM

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this work except in
compliance with the License. You may obtain a copy of the License in the LICENSE file, or at:

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is
distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.*/(function(a,b){function c(a,b){var c=0,d=b.length,e;if(a.constructor===String){for(;c<d;c+=1)if(0===a.localeCompare(b[c]))return c}else for(;c<d;c+=1)if(e=b[c],e.constructor===String){if(0===e.localeCompare(a))return c}else if(e===a)return c;return-1}function d(a,c){return a===c?!0:a===b||c===b||null===a||null===c?!1:a.constructor===String?0===a.localeCompare(c):c.constructor===String?0===c.localeCompare(a):!1}function e(b,c){var d,e,f;if(null===b||1>b.length)return[];d=b.split(c);e=0;for(f=d.length;e<f;e+=1)d[e]=a.trim(d[e]);return d}function f(a){a.bind("keydown",function(){a.data("keyup-change-value",a.val())});a.bind("keyup",function(){a.val()!==a.data("keyup-change-value")&&a.trigger("keyup-change")})}function g(c){c.bind("mousemove",function(c){var d=a(document).data("select2-lastpos");(d===b||d.x!==c.pageX||d.y!==c.pageY)&&a(c.target).trigger("mousemove-filtered",c)})}function h(a,b){var c;return function(){window.clearTimeout(c);c=window.setTimeout(b,a)}}function i(a,b){var d=h(a,function(a){b.trigger("scroll-debounced",a)});b.bind("scroll",function(a){0<=c(a.target,b.get())&&d(a)})}function j(a){a.preventDefault();a.stopPropagation()}function k(b){var c,d=0,e=null,f=b.quietMillis||100;return function(g){window.clearTimeout(c);c=window.setTimeout(function(){var c=d+=1,f=b.data,h=b.transport||a.ajax,f=f.call(this,g.term,g.page);null!==e&&e.abort();e=h.call(null,{url:b.url,dataType:b.dataType,data:f,success:function(a){c<d||g.callback(b.results(a,g.page))}})},f)}}function l(b){var c=b,d=function(a){return a.text};a.isArray(c)||(d=c.text,a.isFunction(d)||(d=function(a){return a[c.text]}),c=c.results);return function(b){var e=b.term.toUpperCase(),f={};if(e==="")b.callback({results:c});else{f.results=a(c).filter(function(){return d(this).toUpperCase().indexOf(e)>=0}).get();b.callback(f)}}}function m(c){return a.isFunction(c)?c:function(d){var e=d.term.toUpperCase(),f={results:[]};a(c).each(function(){var a=this.text!==b,c=a?this.text:this;(""===e||0<=c.toUpperCase().indexOf(e))&&f.results.push(a?this:{id:this,text:this})});d.callback(f)}}function n(b,c){var d=function(){};d.prototype=new b;d.prototype.constructor=d;d.prototype.parent=b.prototype;d.prototype=a.extend(d.prototype,c);return d}if(window.Select2===b){var o,p,q,r;o={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(a){a=a.which?a.which:a;switch(a){case o.LEFT:case o.RIGHT:case o.UP:case o.DOWN:return!0}return!1},isControl:function(a){a=a.which?a.which:a;switch(a){case o.SHIFT:case o.CTRL:case o.ALT:return!0}return!1},isFunctionKey:function(a){a=a.which?a.which:a;return 112<=a&&123>=a}};a(document).delegate("*","mousemove",function(b){a(document).data("select2-lastpos",{x:b.pageX,y:b.pageY})});a(document).ready(function(){a(document).delegate("*","mousedown focusin",function(b){var c=a(b.target).closest("div.select2-container").get(0);a(document).find("div.select2-container-active").each(function(){this!==c&&a(this).data("select2").blur()})})});p=n(Object,{bind:function(a){var b=this;return function(){a.apply(b,arguments)}},init:function(c){var d,e;this.opts=c=this.prepareOpts(c);this.id=c.id;c.element.data("select2")!==b&&this.destroy();this.container=this.createContainer();c.element.attr("class")!==b&&this.container.addClass(c.element.attr("class"));this.opts.element.data("select2",this).hide().after(this.container);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");this.results=d=this.container.find(".select2-results");this.search=e=this.container.find("input[type=text]");this.resultsPage=0;this.initContainer();g(this.results);this.container.delegate(".select2-results","mousemove-filtered",this.bind(this.highlightUnderEvent));i(80,this.results);this.container.delegate(".select2-results","scroll-debounced",this.bind(this.loadMoreIfNeeded));a.fn.mousewheel&&d.mousewheel(function(a,b,c,e){b=d.scrollTop();0<e&&0>=b-e?(d.scrollTop(0),j(a)):0>e&&d.get(0).scrollHeight-d.scrollTop()+e<=d.height()&&(d.scrollTop(d.get(0).scrollHeight-d.height()),j(a))});f(e);e.bind("keyup-change",this.bind(this.updateResults));e.bind("focus",function(){e.addClass("select2-focused")});e.bind("blur",function(){e.removeClass("select2-focused")});this.container.delegate(".select2-results","click",this.bind(function(b){0<a(b.target).closest(".select2-result:not(.select2-disabled)").length?(this.highlightUnderEvent(b),this.selectHighlighted(b)):(j(b),this.focusSearch())}));a.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource())},destroy:function(){var a=this.opts.element.data("select2");a!==b&&(a.container.remove(),a.opts.element.removeData("select2").unbind(".select2").show())},prepareOpts:function(c){var d,f,g;d=c.element;"select"===d.get(0).tagName.toLowerCase()&&(this.select=f=c.element);f&&a.each("id multiple ajax query createSearchChoice initSelection data tags".split(" "),function(){if(this in c)throw Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")});c=a.extend({},{formatResult:function(a){return a.text},formatSelection:function(a){return a.text},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(a,b){return"Please enter "+(b-a.length)+" more characters"},minimumResultsForSearch:0,minimumInputLength:0,id:function(a){return a.id}},c);"function"!=typeof c.id&&(g=c.id,c.id=function(a){return a[g]});f?(c.query=this.bind(function(c){var e={results:[],more:!1},f=c.term.toUpperCase(),g=this.getPlaceholder();d.find("option").each(function(c){var d=a(this),h=d.text();if(c===0&&g!==b&&h==="")return!0;h.toUpperCase().indexOf(f)>=0&&e.results.push({id:d.attr("value"),text:h})});c.callback(e)}),c.id=function(a){return a.id}):"query"in c||("ajax"in c?c.query=k(c.ajax):"data"in c?c.query=l(c.data):"tags"in c&&(c.query=m(c.tags),c.createSearchChoice=function(a){return{id:a,text:a}},c.initSelection=function(b){var c=[];a(e(b.val(),",")).each(function(){c.push({id:this,text:this})});return c}));if("function"!=typeof c.query)throw"query function not defined for Select2 "+c.element.attr("id");return c},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(){!0!==this.opts.element.data("select2-change-triggered")&&this.initSelection()}))},triggerChange:function(){this.opts.element.data("select2-change-triggered",!0);this.opts.element.trigger("change");this.opts.element.data("select2-change-triggered",!1)},opened:function(){return this.container.hasClass("select2-dropdown-open")},open:function(){this.opened()||(this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.updateResults(!0),this.dropdown.show(),this.focusSearch())},close:function(){this.opened()&&(this.dropdown.hide(),this.container.removeClass("select2-dropdown-open"),this.results.empty(),this.clearSearch())},clearSearch:function(){},ensureHighlightVisible:function(){var b=this.results,c,d,e,f;c=b.children(".select2-result");d=this.highlight();0>d||(e=a(c[d]),f=e.offset().top+e.outerHeight(),d===c.length-1&&(c=b.find("li.select2-more-results"),0<c.length&&(f=c.offset().top+c.outerHeight())),c=b.offset().top+b.outerHeight(),f>c&&b.scrollTop(b.scrollTop()+(f-c)),e=e.offset().top-b.offset().top,0>e&&b.scrollTop(b.scrollTop()+e))},moveHighlight:function(b){for(var c=this.results.children(".select2-result"),d=this.highlight();-1<d&&d<c.length;)if(d+=b,!a(c[d]).hasClass("select2-disabled")){this.highlight(d);break}},highlight:function(b){var d=this.results.children(".select2-result");if(0===arguments.length)return c(d.filter(".select2-highlighted")[0],d.get());d.removeClass("select2-highlighted");b>=d.length&&(b=d.length-1);0>b&&(b=0);a(d[b]).addClass("select2-highlighted");this.ensureHighlightVisible();this.opened()&&this.focusSearch()},highlightUnderEvent:function(b){b=a(b.target).closest(".select2-result");0<b.length&&this.highlight(b.index())},loadMoreIfNeeded:function(){var c=this.results,d=c.find("li.select2-more-results"),e,f=-1,g=this.resultsPage+1;0!==d.length&&(e=d.offset().top-c.offset().top-c.height(),0>=e&&(d.addClass("select2-active"),this.opts.query({term:this.search.val(),page:g,callback:this.bind(function(e){var h=[],i=this;a(e.results).each(function(){h.push("<li class='select2-result'>");h.push(i.opts.formatResult(this));h.push("</li>")});d.before(h.join(""));c.find(".select2-result").each(function(c){var d=a(this);d.data("select2-data")!==b?f=c:d.data("select2-data",e.results[c-f-1])});e.more?d.removeClass("select2-active"):d.remove();this.resultsPage=g})})))},updateResults:function(c){function e(a){g.html(a);g.scrollTop(0);f.removeClass("select2-active")}var f=this.search,g=this.results,h=this.opts,i=this;f.addClass("select2-active");f.val().length<h.minimumInputLength?e("<li class='select2-no-results'>"+h.formatInputTooShort(f.val(),h.minimumInputLength)+"</li>"):(this.resultsPage=1,h.query({term:f.val(),page:this.resultsPage,callback:this.bind(function(j){var k=[],l;this.opts.createSearchChoice&&""!==f.val()&&(l=this.opts.createSearchChoice.call(null,f.val(),j.results),l!==b&&null!==l&&i.id(l)!==b&&null!==i.id(l)&&0===a(j.results).filter(function(){return d(i.id(this),i.id(l))}).length&&j.results.unshift(l));0===j.results.length?e("<li class='select2-no-results'>"+h.formatNoMatches(f.val())+"</li>"):(a(j.results).each(function(){k.push("<li class='select2-result'>");k.push(h.formatResult(this));k.push("</li>")}),!0===j.more&&k.push("<li class='select2-more-results'>Loading more results...</li>"),e(k.join("")),g.children(".select2-result").each(function(b){b=j.results[b];a(this).data("select2-data",b)}),this.postprocessResults(j,c))})}))},cancel:function(){this.close()},blur:function(){window.setTimeout(this.bind(function(){this.close();this.container.removeClass("select2-container-active");this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");this.search.blur()}),10)},focusSearch:function(){window.setTimeout(this.bind(function(){this.search.focus()}),10)},selectHighlighted:function(){var a=this.results.find(".select2-highlighted:not(.select2-disabled)").data("select2-data");a&&this.onSelect(a)},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},getContainerWidth:function(){var a,c,d,e;if(this.opts.width!==b)return this.opts.width;a=this.opts.element.attr("style");if(a!==b){a=a.split(";");d=0;for(e=a.length;d<e;d+=1)if(c=a[d].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/),null!==c&&1<=c.length)return c[1]}return this.opts.element.width()+"px"}});q=n(p,{createContainer:function(){return a("<div></div>",{"class":"select2-container",style:"width: "+this.getContainerWidth()}).html("    <a href='javascript:void(0)' class='select2-choice'>   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>   <div><b></b></div></a>    <div class='select2-drop' style='display:none;'>   <div class='select2-search'>       <input type='text' autocomplete='off'/>   </div>   <ul class='select2-results'>   </ul></div>")},open:function(){this.opened()||this.parent.open.apply(this,arguments)},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close();this.selection.focus()},isFocused:function(){return this.selection.is(":focus")},cancel:function(){this.parent.cancel.apply(this,arguments);this.selection.focus()},initContainer:function(){var a,b=this.container,c=!1;this.selection=a=b.find(".select2-choice");this.search.bind("keydown",this.bind(function(a){switch(a.which){case o.UP:case o.DOWN:this.moveHighlight(a.which===o.UP?-1:1);j(a);break;case o.TAB:case o.ENTER:this.selectHighlighted();j(a);break;case o.ESC:this.cancel(a),a.preventDefault()}}));b.delegate(".select2-choice","click",this.bind(function(b){c=!0;this.opened()?(this.close(),a.focus()):this.open();b.preventDefault();c=!1}));b.delegate(".select2-choice","keydown",this.bind(function(a){a.which===o.TAB||o.isControl(a)||o.isFunctionKey(a)||a.which===o.ESC||(this.open(),(a.which===o.PAGE_UP||a.which===o.PAGE_DOWN||a.which===o.SPACE)&&j(a),a.which===o.ENTER&&j(a))}));b.delegate(".select2-choice","focus",function(){b.addClass("select2-container-active")});b.delegate(".select2-choice","blur",this.bind(function(){c||this.opened()||this.blur()}));a.delegate("abbr","click",this.bind(function(a){this.val("");j(a);this.close();this.triggerChange()}));this.setPlaceholder()},initSelection:function(){var a;""===this.opts.element.val()?this.updateSelection({id:"",text:""}):(a=this.opts.initSelection.call(null,this.opts.element),a!==b&&null!==a&&this.updateSelection(a));this.close();this.setPlaceholder()},prepareOpts:function(){var a=this.parent.prepareOpts.apply(this,arguments);"select"===a.element.get(0).tagName.toLowerCase()&&(a.initSelection=function(a){a=a.find(":selected");return{id:a.attr("value"),text:a.text()}});return a},setPlaceholder:function(){var a=this.getPlaceholder();""===this.opts.element.val()&&a!==b&&(!this.select||""===this.select.find("option:first").text())&&("object"==typeof a?this.updateSelection(a):this.selection.find("span").html(a),this.selection.addClass("select2-default"),this.selection.find("abbr").hide())},postprocessResults:function(b,c){var e=0,f=this,g=!0;this.results.find(".select2-result").each(function(b){if(d(f.id(a(this).data("select2-data")),f.opts.element.val()))return e=b,!1});this.highlight(e);!0===c&&(g=b.results.length>=this.opts.minimumResultsForSearch,this.search.parent().toggle(g),this.container[g?"addClass":"removeClass"]("select2-with-searchbox"))},onSelect:function(a){var b=this.opts.element.val();this.opts.element.val(this.id(a));this.updateSelection(a);this.close();this.selection.focus();d(b,this.id(a))||this.triggerChange()},updateSelection:function(a){this.selection.find("span").html(this.opts.formatSelection(a));this.selection.removeClass("select2-default");this.opts.allowClear&&this.getPlaceholder()!==b&&this.selection.find("abbr").show()},val:function(){var b,c=null;if(0===arguments.length)return this.opts.element.val();b=arguments[0];this.select?(this.select.val(b).find(":selected").each(function(){c={id:a(this).attr("value"),text:a(this).text()};return!1}),this.updateSelection(c)):(this.opts.element.val(b?this.id(b):""),this.updateSelection(b));this.setPlaceholder()},clearSearch:function(){this.search.val("")}});r=n(p,{createContainer:function(){return a("<div></div>",{"class":"select2-container select2-container-multi",style:"width: "+this.getContainerWidth()}).html("    <ul class='select2-choices'>  <li class='select2-search-field'>    <input type='text' autocomplete='off' style='width: 25px;'>  </li></ul><div class='select2-drop' style='display:none;'>   <ul class='select2-results'>   </ul></div>")},prepareOpts:function(){var b=this.parent.prepareOpts.apply(this,arguments),b=a.extend({},{closeOnSelect:!0},b);"select"===b.element.get(0).tagName.toLowerCase()&&(b.initSelection=function(b){var c=[];b.find(":selected").each(function(){c.push({id:a(this).attr("value"),text:a(this).text()})});return c});return b},initContainer:function(){var a;this.searchContainer=this.container.find(".select2-search-field");this.selection=a=this.container.find(".select2-choices");this.search.bind("keydown",this.bind(function(b){if(b.which===o.BACKSPACE&&""===this.search.val()){this.close();var c;c=a.find(".select2-search-choice-focus");if(0<c.length){this.unselect(c.first());this.search.width(10);j(b);return}c=a.find(".select2-search-choice");0<c.length&&c.last().addClass("select2-search-choice-focus")}else a.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");if(this.opened())switch(b.which){case o.UP:case o.DOWN:this.moveHighlight(b.which===o.UP?-1:1);j(b);return;case o.ENTER:this.selectHighlighted();j(b);return;case o.ESC:this.cancel(b);b.preventDefault();return}b.which===o.TAB||o.isControl(b)||o.isFunctionKey(b)||b.which===o.BACKSPACE||b.which===o.ESC||(this.open(),(b.which===o.PAGE_UP||b.which===o.PAGE_DOWN)&&j(b))}));this.search.bind("keyup",this.bind(this.resizeSearch));this.container.delegate(".select2-choices","click",this.bind(function(a){this.open();this.focusSearch();a.preventDefault()}));this.container.delegate(".select2-choices","focus",this.bind(function(){this.container.addClass("select2-container-active");this.clearPlaceholder()}));this.clearSearch()},initSelection:function(){var a;""===this.opts.element.val()&&this.updateSelection([]);if(this.select||""!==this.opts.element.val())a=this.opts.initSelection.call(null,this.opts.element),a!==b&&null!==a&&this.updateSelection(a);this.close();this.clearSearch()},clearSearch:function(){var a=this.getPlaceholder();a!==b&&0===this.getVal().length&&!1===this.search.hasClass("select2-focused")?(this.search.val(a).addClass("select2-default"),this.search.width(this.getContainerWidth())):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},open:function(){this.opened()||(this.parent.open.apply(this,arguments),this.resizeSearch(),this.focusSearch())},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close();this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(b){var d=[],e=[],f=this;a(b).each(function(){0>c(f.id(this),d)&&(d.push(f.id(this)),e.push(this))});b=e;this.selection.find(".select2-search-choice").remove();a(b).each(function(){f.addSelectedChoice(this)});f.postprocessResults()},onSelect:function(a){this.addSelectedChoice(a);this.select&&this.postprocessResults();this.opts.closeOnSelect?(this.close(),this.search.width(10)):(this.search.width(10),this.resizeSearch());this.triggerChange();this.focusSearch()},cancel:function(){this.close();this.focusSearch()},addSelectedChoice:function(b){var c,d=this.id(b),e=this.getVal();c=["<li class='select2-search-choice'>",this.opts.formatSelection(b),"<a href='javascript:void(0)' class='select2-search-choice-close' tabindex='-1'></a>","</li>"];c=a(c.join(""));c.find("a").bind("click dblclick",this.bind(function(b){this.unselect(a(b.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");j(b);this.close();this.focusSearch()})).bind("focus",this.bind(function(){this.container.addClass("select2-container-active")}));c.data("select2-data",b);c.insertBefore(this.searchContainer);e.push(d);this.setVal(e)},unselect:function(a){var b=this.getVal(),d,a=a.closest(".select2-search-choice");if(0===a.length)throw"Invalid argument: "+a+". Must be .select2-search-choice";d=c(this.id(a.data("select2-data")),b);0<=d&&(b.splice(d,1),this.setVal(b),this.select&&this.postprocessResults());a.remove();this.triggerChange()},postprocessResults:function(){var b=this.getVal(),d=this.results.find(".select2-result"),e=this;d.each(function(){var d=a(this),f=e.id(d.data("select2-data"));0<=c(f,b)?d.addClass("select2-disabled"):d.removeClass("select2-disabled")});d.each(function(b){if(!a(this).hasClass("select2-disabled"))return e.highlight(b),!1})},resizeSearch:function(){var b,c,d,e;d=this.search;b=a("<div></div>").css({position:"absolute",left:"-1000px",top:"-1000px",display:"none",fontSize:d.css("fontSize"),fontFamily:d.css("fontFamily"),fontStyle:d.css("fontStyle"),fontWeight:d.css("fontWeight"),letterSpacing:d.css("letterSpacing"),textTransform:d.css("textTransform"),whiteSpace:"nowrap"});b.text(d.val());a("body").append(b);d=b.width();b.remove();b=d+10;c=this.search.offset().left;d=this.selection.width();e=this.selection.offset().left;c=d-(c-e)-(this.search.outerWidth()-this.search.width());c<b&&(c=d-(this.search.outerWidth()-this.search.width()));40>c&&(c=d-(this.search.outerWidth()-this.search.width()));this.search.width(c)},getVal:function(){var a;if(this.select)return a=this.select.val(),null===a?[]:a;a=this.opts.element.val();return e(a,",")},setVal:function(b){var d=[];this.select?this.select.val(b):(a(b).each(function(){0>c(this,d)&&d.push(this)}),this.opts.element.val(0===d.length?"":d.join(",")))},val:function(){var b,c=[],d=this;if(0===arguments.length)return this.getVal();b=arguments[0];this.select?(this.setVal(b),this.select.find(":selected").each(function(){c.push({id:a(this).attr("value"),text:a(this).text()})}),this.updateSelection(c)):(b=null===b?[]:b,this.setVal(b),a(b).each(function(){c.push(d.id(this))}),this.setVal(c),this.updateSelection(b));this.clearSearch()}});a.fn.select2=function(){var d=Array.prototype.slice.call(arguments,0),e,f,g,h,i="val destroy open close focus isFocused".split(" ");this.each(function(){if(0===d.length||"object"==typeof d[0])e=0===d.length?{}:a.extend({},d[0]),e.element=a(this),"select"===e.element.get(0).tagName.toLowerCase()?h=e.element.attr("multiple"):(h=e.multiple||!1,"tags"in e&&(e.multiple=h=!0)),f=h?new r:new q,f.init(e);else{if("string"!=typeof d[0])throw"Invalid arguments to select2 plugin: "+d;if(0>c(d[0],i))throw"Unknown method: "+d[0];g=b;f=a(this).data("select2");if(f!==b&&(g=f[d[0]].apply(f,d.slice(1)),g!==b))return!1}});return g===b?this:g};window.Select2={query:{ajax:k,local:l,tags:m},util:{debounce:h},"class":{"abstract":p,single:q,multi:r}}}})(jQuery);